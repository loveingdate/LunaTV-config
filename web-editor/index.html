<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ™ Luna TV é…ç½®ç¼–è¾‘å™¨</title>
    <meta name="description" content="ä¸“ä¸šçš„JSONé…ç½®æ–‡ä»¶ç¼–è¾‘å™¨ï¼Œä¸“ä¸ºLuna TVé…ç½®ç®¡ç†è€Œè®¾è®¡">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ™</text></svg>">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="styles/main.css">
</head>
<body data-theme="dark">
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>æ­£åœ¨åŠ è½½ç¼–è¾‘å™¨...</p>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div id="app" class="app-container" style="display: none;">
        <!-- å¤´éƒ¨å·¥å…·æ  -->
        <header class="header">
            <div class="header-left">
                <h1 class="app-title">ğŸŒ™ Luna TV é…ç½®ç¼–è¾‘å™¨</h1>
                <div class="status-indicator" id="status">
                    <span class="status-dot"></span>
                    <span class="status-text">æœªè¿æ¥</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="btn btn-icon" id="theme-toggle" title="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
                <button class="btn btn-icon" id="fullscreen-toggle" title="å…¨å±æ¨¡å¼ (F11)">â›¶</button>
                <button class="btn btn-primary" id="save-btn" title="ä¿å­˜åˆ° GitHub (Ctrl+S)">ğŸ’¾ ä¿å­˜</button>
            </div>
        </header>

        <!-- å·¥å…·æ  -->
        <nav class="toolbar">
            <div class="toolbar-section">
                <button class="btn btn-secondary" id="load-btn" title="ä» GitHub åŠ è½½ (Ctrl+O)">ğŸ“¥ åŠ è½½é…ç½®</button>
                <button class="btn btn-secondary" id="upload-btn" title="ä¸Šä¼ æ–‡ä»¶ (Ctrl+U)">ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</button>
                <button class="btn btn-secondary" id="download-btn" title="ä¸‹è½½æ–‡ä»¶ (Ctrl+D)">ğŸ“¥ ä¸‹è½½æ–‡ä»¶</button>
            </div>
            
            <div class="toolbar-section">
                <button class="btn btn-outline" id="format-btn" title="æ ¼å¼åŒ– JSON">ğŸ”§ æ ¼å¼åŒ–</button>
                <button class="btn btn-outline" id="compress-btn" title="å‹ç¼© JSON">ğŸ“¦ å‹ç¼©</button>
                <button class="btn btn-outline" id="validate-btn" title="éªŒè¯ JSON">âœ… éªŒè¯</button>
            </div>
            
            <div class="toolbar-section">
                <select id="view-mode" class="select" title="åˆ‡æ¢è§†å›¾æ¨¡å¼">
                    <option value="editor">ç¼–è¾‘å™¨</option>
                    <option value="tree">æ ‘çŠ¶å›¾</option>
                    <option value="split">åˆ†å±</option>
                </select>
            </div>
        </nav>

        <!-- GitHub Token è¾“å…¥åŒºåŸŸ -->
        <div id="token-section" class="token-section">
            <div class="token-input-group">
                <label for="github-token">GitHub Personal Access Token:</label>
                <div class="input-with-button">
                    <input 
                        type="password" 
                        id="github-token" 
                        placeholder="è¯·è¾“å…¥æ‚¨çš„ GitHub Token" 
                        autocomplete="current-password"
                    >
                    <button class="btn btn-primary" id="connect-btn">è¿æ¥</button>
                </div>
                <small class="help-text">
                    éœ€è¦ <code>repo</code> æƒé™ã€‚<a href="https://github.com/settings/tokens" target="_blank">è·å– Token</a>
                </small>
            </div>
        </div>

        <!-- ä¸»ç¼–è¾‘åŒºåŸŸ -->
        <main class="main-content">
            <!-- ç¼–è¾‘å™¨å®¹å™¨ -->
            <div class="editor-container">
                <div id="monaco-editor" class="editor"></div>
                
                <!-- é”™è¯¯æç¤º -->
                <div id="error-panel" class="error-panel" style="display: none;">
                    <div class="error-header">
                        <span class="error-icon">âš ï¸</span>
                        <span class="error-title">JSON æ ¼å¼é”™è¯¯</span>
                        <button class="error-close" id="close-error">âœ•</button>
                    </div>
                    <div class="error-content" id="error-message"></div>
                </div>
            </div>

            <!-- ä¾§è¾¹é¢æ¿ -->
            <aside class="side-panel" id="side-panel" style="display: none;">
                <div class="panel-header">
                    <h3 class="panel-title">JSON æ ‘çŠ¶è§†å›¾</h3>
                    <button class="btn btn-icon" id="close-panel">âœ•</button>
                </div>
                <div class="panel-content">
                    <div id="json-tree" class="json-tree"></div>
                </div>
            </aside>
        </main>

        <!-- åº•éƒ¨çŠ¶æ€æ  -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="cursor-position">è¡Œ 1, åˆ— 1</span>
                <span id="file-size">0 å­—ç¬¦</span>
                <span id="encoding">UTF-8</span>
            </div>
            
            <div class="status-right">
                <span id="last-saved">æœªä¿å­˜</span>
                <span id="json-status" class="status-valid">JSON æœ‰æ•ˆ</span>
            </div>
        </footer>
    </div>

    <!-- æ¨¡æ€å¯¹è¯æ¡† -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">æ ‡é¢˜</h3>
                <button class="btn btn-icon" id="modal-close">âœ•</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- åŠ¨æ€å†…å®¹ -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="modal-confirm">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast-container" class="toast-container"></div>

    <!-- éšè—çš„æ–‡ä»¶è¾“å…¥ -->
    <input type="file" id="file-input" accept=".json" style="display: none;">

    <!-- è„šæœ¬åŠ è½½ -->
    <!-- ä½¿ç”¨å¤šä¸ªCDNå¤‡é€‰æ–¹æ¡ˆç¡®ä¿Monaco Editorèƒ½å¤ŸåŠ è½½ -->
    <script>
        // Monaco Editor åŠ è½½å™¨
        window.monacoLoaderConfig = {
            paths: {
                'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs'
            },
            'vs/nls': {
                availableLanguages: {
                    '*': 'zh-cn'
                }
            }
        };
        
        // å¤‡é€‰CDNåˆ—è¡¨
        const monacoUrls = [
            'https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js',
            'https://unpkg.com/monaco-editor@0.44.0/min/vs/loader.js',
            'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js'
        ];
        
        async function loadMonaco() {
            for (const url of monacoUrls) {
                try {
                    console.log('å°è¯•ä»CDNåŠ è½½Monaco Editor:', url);
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = url;
                        script.onload = resolve;
                        script.onerror = reject;
                        script.timeout = 10000; // 10ç§’è¶…æ—¶
                        document.head.appendChild(script);
                    });
                    
                    // é…ç½®Monacoè·¯å¾„
                    require.config(window.monacoLoaderConfig);
                    
                    // åŠ è½½Monaco Editor
                    require(['vs/editor/editor.main'], function() {
                        console.log('Monaco Editor åŠ è½½æˆåŠŸ');
                        window.monacoReady = true;
                        
                        // è§¦å‘åº”ç”¨åˆå§‹åŒ–
                        document.dispatchEvent(new Event('monaco-ready'));
                    });
                    
                    return; // æˆåŠŸåŠ è½½ï¼Œé€€å‡ºå¾ªç¯
                } catch (error) {
                    console.warn('CDNåŠ è½½å¤±è´¥:', url, error);
                    continue; // å°è¯•ä¸‹ä¸€ä¸ªCDN
                }
            }
            
            // æ‰€æœ‰CDNéƒ½å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨ç¼–è¾‘å™¨
            console.error('æ‰€æœ‰Monaco Editor CDNéƒ½æ— æ³•åŠ è½½ï¼Œä½¿ç”¨å¤‡ç”¨ç¼–è¾‘å™¨');
            window.useBackupEditor = true;
            document.dispatchEvent(new Event('monaco-ready'));
        }
        
        // å¼€å§‹åŠ è½½Monaco
        loadMonaco();
    </script>
    
    <!-- åº”ç”¨è„šæœ¬ -->
    <script src="scripts/utils.js"></script>
    <script src="scripts/github-api.js"></script>
    <script src="scripts/editor.js"></script>
    <script src="scripts/app.js"></script>
</body>
</html>
