<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Luna TV配置编辑器 - 专业的JSON配置文件编辑工具">
    <title>🌙 Luna TV 配置编辑器</title>
    
    <!-- PWA 支持 -->
    <link rel="manifest" href="assets/manifest.json">
    <meta name="theme-color" content="#1e1e1e">
    
    <!-- 样式文件 -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/themes.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- 外部库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌙</text></svg>">
</head>
<body class="theme-dark">
    <!-- 页面加载器 -->
    <div class="page-loader" id="pageLoader">
        <div class="loader-content">
            <div class="loader-icon">🌙</div>
            <div class="loader-text">加载 Luna TV 编辑器...</div>
            <div class="loader-progress"><div class="progress-bar"></div></div>
        </div>
    </div>

    <!-- 主应用容器 -->
    <div class="app-container" id="appContainer">
        <!-- 顶部导航栏 -->
        <header class="app-header">
            <div class="header-left">
                <div class="app-logo">
                    <span class="logo-icon">🌙</span>
                    <span class="logo-text">Luna TV 配置编辑器</span>
                </div>
                <div class="app-status" id="appStatus">
                    <span class="status-indicator"></span>
                    <span class="status-text">准备就绪</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="header-btn" id="settingsBtn" title="设置">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="header-btn" id="themeToggle" title="切换主题">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-btn" id="helpBtn" title="帮助">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </header>

        <!-- 工具栏 -->
        <div class="toolbar">
            <div class="toolbar-section">
                <div class="btn-group">
                    <button class="btn btn-primary" id="loadConfigBtn">
                        <i class="fas fa-cloud-download-alt"></i>
                        <span>📥 加载配置</span>
                    </button>
                    <button class="btn btn-success" id="saveConfigBtn" disabled>
                        <i class="fas fa-save"></i>
                        <span>💾 保存配置</span>
                    </button>
                </div>
            </div>
            
            <div class="toolbar-section">
                <div class="btn-group">
                    <button class="btn btn-secondary" id="formatBtn">
                        <i class="fas fa-code"></i>
                        <span>格式化</span>
                    </button>
                    <button class="btn btn-secondary" id="compressBtn">
                        <i class="fas fa-compress-alt"></i>
                        <span>压缩</span>
                    </button>
                    <button class="btn btn-secondary" id="validateBtn">
                        <i class="fas fa-check-circle"></i>
                        <span>验证</span>
                    </button>
                </div>
            </div>
            
            <div class="toolbar-section">
                <div class="btn-group">
                    <input type="file" id="fileInput" accept=".json" class="file-input" />
                    <button class="btn btn-info" id="uploadBtn">
                        <i class="fas fa-upload"></i>
                        <span>上传文件</span>
                    </button>
                    <button class="btn btn-info" id="downloadBtn">
                        <i class="fas fa-download"></i>
                        <span>下载文件</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- GitHub配置面板 -->
        <div class="github-panel collapsed" id="githubPanel">
            <div class="panel-header">
                <h3 class="panel-title">
                    <i class="fab fa-github"></i>
                    GitHub 配置
                </h3>
                <button class="panel-toggle" id="githubPanelToggle">
                    <i class="fas fa-chevron-down"></i>
                </button>
            </div>
            <div class="panel-content">
                <div class="config-grid">
                    <div class="config-group">
                        <label for="githubToken" class="config-label">GitHub Token *</label>
                        <div class="input-wrapper">
                            <input type="password" id="githubToken" class="config-input" 
                                   placeholder="ghp_xxxxxxxxxxxx" 
                                   autocomplete="current-password">
                            <button class="input-btn" id="toggleTokenVisibility">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="config-hint">需要 'repo' 权限的 Personal Access Token</small>
                    </div>
                    
                    <div class="config-group">
                        <label for="repoOwner" class="config-label">仓库所有者</label>
                        <input type="text" id="repoOwner" class="config-input" value="hafrey1">
                    </div>
                    
                    <div class="config-group">
                        <label for="repoName" class="config-label">仓库名称</label>
                        <input type="text" id="repoName" class="config-input" value="LunaTV-config">
                    </div>
                    
                    <div class="config-group">
                        <label for="filePath" class="config-label">文件路径</label>
                        <select id="filePath" class="config-input">
                            <option value="luna-tv-config.json">luna-tv-config.json (主配置)</option>
                            <option value="jinhuang.json">jinhuang.json (无黄配置)</option>
                        </select>
                    </div>
                </div>
                
                <div class="config-actions">
                    <button class="btn btn-outline" id="testConnectionBtn">
                        <i class="fas fa-plug"></i>
                        测试连接
                    </button>
                    <button class="btn btn-outline" id="clearTokenBtn">
                        <i class="fas fa-trash"></i>
                        清除Token
                    </button>
                </div>
            </div>
        </div>

        <!-- 主编辑区域 -->
        <div class="editor-container">
            <!-- 编辑器标签栏 -->
            <div class="editor-tabs">
                <button class="tab-btn active" data-tab="editor">
                    <i class="fas fa-code"></i>
                    <span>JSON 编辑器</span>
                </button>
                <button class="tab-btn" data-tab="tree">
                    <i class="fas fa-sitemap"></i>
                    <span>树状视图</span>
                </button>
                <button class="tab-btn" data-tab="preview">
                    <i class="fas fa-eye"></i>
                    <span>预览模式</span>
                </button>
            </div>
            
            <!-- 编辑器内容区 -->
            <div class="editor-content">
                <!-- Monaco 编辑器 -->
                <div class="editor-tab active" data-tab="editor">
                    <div id="monacoEditor" class="monaco-container"></div>
                </div>
                
                <!-- 树状视图 -->
                <div class="editor-tab" data-tab="tree">
                    <div class="tree-container">
                        <div class="tree-toolbar">
                            <button class="btn btn-small" id="expandAllBtn">
                                <i class="fas fa-expand-alt"></i> 全部展开
                            </button>
                            <button class="btn btn-small" id="collapseAllBtn">
                                <i class="fas fa-compress-alt"></i> 全部折叠
                            </button>
                        </div>
                        <div id="jsonTree" class="json-tree"></div>
                    </div>
                </div>
                
                <!-- 预览模式 -->
                <div class="editor-tab" data-tab="preview">
                    <div class="preview-container">
                        <div class="preview-toolbar">
                            <button class="btn btn-small" id="copyPreviewBtn">
                                <i class="fas fa-copy"></i> 复制
                            </button>
                        </div>
                        <pre id="jsonPreview" class="json-preview"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- 状态栏 -->
        <div class="status-bar">
            <div class="status-left">
                <span class="status-item" id="fileInfo">未加载文件</span>
                <span class="status-item" id="fileSize">0 B</span>
                <span class="status-item" id="lastSaved"></span>
            </div>
            <div class="status-center">
                <span class="status-item validation-status" id="validationStatus">
                    <i class="fas fa-check-circle"></i> 有效 JSON
                </span>
            </div>
            <div class="status-right">
                <span class="status-item" id="cursorPosition">行 1, 列 1</span>
                <span class="status-item" id="selectionInfo"></span>
            </div>
        </div>
    </div>

    <!-- 模态框容器 -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- 帮助模态框 -->
        <div class="modal help-modal" id="helpModal">
            <div class="modal-header">
                <h3 class="modal-title">使用帮助</h3>
                <button class="modal-close" data-modal="help">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="help-section">
                    <h4>🚀 快速开始</h4>
                    <ol>
                        <li>在 GitHub 配置区域输入您的 Personal Access Token</li>
                        <li>点击 "📥 加载配置" 从仓库加载JSON文件</li>
                        <li>在编辑器中修改配置</li>
                        <li>点击 "💾 保存配置" 或使用 Ctrl+S 保存到仓库</li>
                    </ol>
                </div>
                
                <div class="help-section">
                    <h4>⌨️ 快捷键</h4>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item">
                            <kbd>Ctrl + S</kbd>
                            <span>保存到GitHub</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl + O</kbd>
                            <span>从GitHub加载</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl + U</kbd>
                            <span>上传文件</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl + D</kbd>
                            <span>下载文件</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl + F</kbd>
                            <span>查找</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Ctrl + H</kbd>
                            <span>查找替换</span>
                        </div>
                    </div>
                </div>
                
                <div class="help-section">
                    <h4>🔑 获取 GitHub Token</h4>
                    <p>1. 访问 <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings → Personal access tokens</a></p>
                    <p>2. 点击 "Generate new token (classic)"</p>
                    <p>3. 选择 <code>repo</code> 权限</p>
                    <p>4. 复制生成的Token并粘贴到配置区域</p>
                </div>
            </div>
        </div>
        
        <!-- 设置模态框 -->
        <div class="modal settings-modal" id="settingsModal">
            <div class="modal-header">
                <h3 class="modal-title">编辑器设置</h3>
                <button class="modal-close" data-modal="settings">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-content">
                <div class="settings-section">
                    <h4>编辑器选项</h4>
                    <div class="setting-item">
                        <label class="setting-label">字体大小</label>
                        <input type="range" id="fontSizeSlider" min="10" max="24" value="14" class="setting-slider">
                        <span id="fontSizeValue">14px</span>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">Tab 大小</label>
                        <select id="tabSizeSelect" class="setting-select">
                            <option value="2">2 空格</option>
                            <option value="4">4 空格</option>
                            <option value="8">8 空格</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">自动换行</label>
                        <input type="checkbox" id="wordWrapToggle" class="setting-checkbox">
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">显示小地图</label>
                        <input type="checkbox" id="minimapToggle" class="setting-checkbox" checked>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h4>应用选项</h4>
                    <div class="setting-item">
                        <label class="setting-label">自动保存间隔</label>
                        <select id="autoSaveInterval" class="setting-select">
                            <option value="0">禁用</option>
                            <option value="30">30秒</option>
                            <option value="60">1分钟</option>
                            <option value="300">5分钟</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <label class="setting-label">历史记录数量</label>
                        <input type="number" id="historySize" class="setting-input" min="5" max="50" value="10">
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn btn-outline" id="resetSettingsBtn">
                        <i class="fas fa-undo"></i> 重置设置
                    </button>
                    <button class="btn btn-primary" id="saveSettingsBtn">
                        <i class="fas fa-save"></i> 保存设置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 通知容器 -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- 脚本文件 -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/github-api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Monaco Editor -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
</body>
</html>
