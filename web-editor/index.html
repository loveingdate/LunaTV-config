<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåô Luna TV ÈÖçÁΩÆÁºñËæëÂô® - JSON Formatter & Validator</title>
    <meta name="description" content="‰∏ì‰∏öÁöÑJSONÈÖçÁΩÆÊñá‰ª∂ÁºñËæëÂô®Ôºå‰∏ì‰∏∫Luna TVÈÖçÁΩÆÁÆ°ÁêÜËÄåËÆæËÆ°">
    <meta name="keywords" content="JSON,ÁºñËæëÂô®,Ê†ºÂºèÂåñ,È™åËØÅ,Luna TV,ÈÖçÁΩÆ">
    
    <!-- PWA ÈÖçÁΩÆ -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üåô</text></svg>">
    
    <style>
        :root {
            --primary-green: #28a745;
            --primary-blue: #007bff;
            --primary-orange: #fd7e14;
            --primary-red: #dc3545;
            --primary-purple: #6f42c1;
            --bg-primary: #1e1e1e;
            --bg-secondary: #252525;
            --bg-tertiary: #2d2d30;
            --bg-card: #1e1e1e;
            --text-primary: #d4d4d4;
            --text-secondary: #cccccc;
            --text-muted: #969696;
            --border-color: #3e3e42;
            --border-radius: 6px;
            --gradient-primary: linear-gradient(135deg, var(--primary-blue), var(--primary-purple));
            --gradient-success: linear-gradient(135deg, var(--primary-green), #20c997);
            --transition: all 0.3s ease;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.15);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.2);
        }
        
        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-card: #ffffff;
            --text-primary: #24292e;
            --text-secondary: #586069;
            --text-muted: #6a737d;
            --border-color: #e1e4e8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            height: 100%;
            font-family: 'Segoe UI', 'SF Pro Display', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        /* Â∫îÁî®ÂÆπÂô®Â∏ÉÂ±Ä */
        .app-container {
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 300px;
            grid-template-rows: auto auto auto 1fr auto;
            grid-template-areas: 
                "header history"
                "toolbar history"
                "token history"
                "main history"
                "status history";
        }
        
        /* ÂÖ®Â±èÊ®°ÂºèÊ†∑Âºè */
        .fullscreen {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            z-index: 9999;
            background: var(--bg-primary);
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: auto 1fr;
            grid-template-areas: 
                "fullscreen-toolbar"
                "fullscreen-main";
        }
        
        .fullscreen .header,
        .fullscreen .toolbar,
        .fullscreen .token-section,
        .fullscreen .status-bar,
        .fullscreen .history-sidebar {
            display: none;
        }
        
        /* ÂÖ®Â±èÂ∑•ÂÖ∑Ê†è */
        .fullscreen-toolbar {
            grid-area: fullscreen-toolbar;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 20px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }
        
        .fullscreen .fullscreen-toolbar {
            display: flex;
        }
        
        .fullscreen .main-content {
            grid-area: fullscreen-main;
            margin: 0;
        }
        
        /* Â§¥ÈÉ®Ê†∑Âºè */
        .header {
            grid-area: header;
            background: var(--gradient-primary);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 1;
        }
        
        .app-title {
            color: white;
            font-size: 20px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .project-link {
            color: rgba(255,255,255,0.9);
            text-decoration: none;
            font-size: 14px;
            background: rgba(255,255,255,0.1);
            padding: 6px 12px;
            border-radius: var(--border-radius);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .project-link:hover {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateY(-1px);
        }
        
        .status-indicator {
            background: rgba(255,255,255,0.15);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--primary-red);
            transition: var(--transition);
        }
        
        .status-dot.connected {
            background: var(--primary-green);
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.6);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1;
        }
        
        /* Â∑•ÂÖ∑Ê†èÊ†∑Âºè */
        .toolbar {
            grid-area: toolbar;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            box-shadow: var(--shadow-sm);
        }
        
        .toolbar-section {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* ÊåâÈíÆÊ†∑Âºè */
        .btn {
            position: relative;
            overflow: hidden;
            padding: 8px 14px;
            font-weight: 500;
            font-size: 13px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            background: transparent;
            white-space: nowrap;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
            transition: var(--transition);
        }
        
        .btn:hover:not(:disabled)::before { left: 100%; }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover:not(:disabled) {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary-green);
            color: var(--primary-green);
        }
        
        .btn-outline:hover:not(:disabled) {
            background: var(--primary-green);
            color: white;
        }
        
        .btn-icon {
            width: 36px; height: 36px;
            padding: 0;
            border-radius: 50%;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-sm {
            padding: 4px 8px;
            font-size: 11px;
        }
        
        /* JSONÊñá‰ª∂ÈÄâÊã©Âô® */
        .json-selector select {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 13px;
            min-width: 200px;
            cursor: pointer;
        }
        
        .json-selector select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }
        
        /* Token ËæìÂÖ•Âå∫ */
        .token-section {
            grid-area: token;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 16px 24px;
        }
        
        .token-input-group {
            max-width: 800px;
        }
        
        .token-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .input-with-button {
            display: flex;
            gap: 12px;
            margin-bottom: 8px;
        }
        
        .input-with-button input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }
        
        .input-with-button input:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(0,123,255,0.1);
        }
        
        .help-text {
            font-size: 12px;
            color: var(--text-muted);
            line-height: 1.4;
        }
        
        .help-text a {
            color: var(--primary-blue);
            text-decoration: none;
        }
        
        .help-text a:hover {
            text-decoration: underline;
        }
        
        .help-text code {
            background: var(--bg-tertiary);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
            font-size: 11px;
        }
        
        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .main-content {
            grid-area: main;
            display: flex;
            flex-direction: column;
            background: var(--bg-primary);
            overflow: hidden;
            margin: 8px 0 8px 8px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .editor-header {
            background: var(--bg-secondary);
            padding: 8px 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        
        .current-file {
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .editor-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Êü•ÊâæÊ†è */
        .search-bar {
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
            padding: 8px 16px;
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .search-bar input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 12px;
        }
        
        .search-bar input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }
        
        .search-info {
            color: var(--text-muted);
            font-size: 11px;
            min-width: 40px;
            text-align: center;
        }
        
        /* ÁºñËæëÂô® */
        .editor {
            flex: 1;
            background: var(--bg-card);
            font-family: 'Monaco', 'Menlo', 'SF Mono', 'Consolas', 'Liberation Mono', 'Courier New', monospace;
            border: none;
            outline: none;
            resize: none;
            padding: 20px;
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
            tab-size: 2;
        }
        
        .editor::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }
        
        /* ÂéÜÂè≤ËÆ∞ÂΩï‰æßËæπÊ†è */
        .history-sidebar {
            grid-area: history;
            background: var(--bg-card);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 8px 8px 8px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }
        
        .history-header {
            background: var(--gradient-primary);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }
        
        .history-header h3 {
            font-size: 14px;
            font-weight: 600;
        }
        
        .history-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .history-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .history-item {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            cursor: pointer;
            transition: var(--transition);
            font-size: 12px;
        }
        
        .history-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary-blue);
            transform: translateY(-1px);
        }
        
        .history-item.active {
            border-color: var(--primary-blue);
            background: rgba(0, 123, 255, 0.1);
        }
        
        .history-time {
            color: var(--text-muted);
            font-size: 11px;
            margin-bottom: 4px;
        }
        
        .history-preview {
            font-family: monospace;
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 6px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }
        
        .history-empty {
            color: var(--text-muted);
            text-align: center;
            padding: 40px 20px;
            font-style: italic;
        }
        
        /* Áä∂ÊÄÅÊ†è */
        .status-bar {
            grid-area: status;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 8px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .status-valid {
            color: var(--primary-green);
            font-weight: 500;
        }
        
        .status-invalid {
            color: var(--primary-red);
            font-weight: 500;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* ÈîôËØØÈù¢Êùø */
        .error-panel {
            position: absolute;
            bottom: 0; left: 0; right: 0;
            background: linear-gradient(135deg, var(--primary-red), #dc2626);
            color: white;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            animation: slideUp 0.3s ease-out;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .error-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .error-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--transition);
            font-size: 16px;
        }
        
        .error-close:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .error-content {
            padding: 12px 16px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            line-height: 1.5;
        }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 48px; height: 48px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        .loading-text {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ToastÈÄöÁü• */
        .toast-container {
            position: fixed;
            top: 20px; right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }
        
        .toast {
            padding: 14px 18px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            font-size: 13px;
            box-shadow: var(--shadow-lg);
            animation: toastSlideIn 0.3s ease-out;
            cursor: pointer;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        @keyframes toastSlideIn {
            from { opacity: 0; transform: translateX(100%) scale(0.95); }
            to { opacity: 1; transform: translateX(0) scale(1); }
        }
        
        .toast.success { background: var(--gradient-success); }
        .toast.error { background: linear-gradient(135deg, var(--primary-red), #dc2626); }
        .toast.warning { background: linear-gradient(135deg, var(--primary-orange), #f59e0b); }
        .toast.info { background: var(--gradient-primary); }
        
        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1024px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-areas: 
                    "header"
                    "toolbar"
                    "token"
                    "main"
                    "status";
            }
            
            .history-sidebar {
                position: fixed;
                top: 0; right: 0; bottom: 0;
                width: 320px;
                z-index: 1000;
                transform: translateX(100%);
                transition: var(--transition);
                margin: 0;
                border-radius: 0;
            }
            
            .history-sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin: 8px;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
            }
            
            .app-title {
                font-size: 16px;
            }
            
            .toolbar {
                padding: 8px 16px;
                gap: 8px;
            }
            
            .toolbar-section {
                flex-wrap: wrap;
                gap: 6px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .json-selector select {
                min-width: 150px;
            }
            
            .token-section {
                padding: 12px 16px;
            }
            
            .history-sidebar {
                width: 280px;
            }
        }
        
        /* ÈÄâÊã©ÊñáÊú¨Ê†∑Âºè */
        ::selection {
            background: rgba(0, 123, 255, 0.3);
            color: inherit;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-blue);
        }
    </style>
</head>
<body data-theme="dark">
    <!-- Âä†ËΩΩÁïåÈù¢ -->
    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Ê≠£Âú®Âä†ËΩΩ Luna TV ÈÖçÁΩÆÁºñËæëÂô®...</div>
    </div>

    <!-- ‰∏ªÂ∫îÁî® -->
    <div id="app" class="app-container" style="display: none;">
        <!-- Â§¥ÈÉ® -->
        <header class="header">
            <div class="header-left">
                <h1 class="app-title">üåô Luna TV ÈÖçÁΩÆÁºñËæëÂô®</h1>
                <a href="https://github.com/hafrey1/LunaTV-config" class="project-link" target="_blank">GitHub È°πÁõÆ</a>
                <div class="status-indicator" id="status">
                    <span class="status-dot"></span>
                    <span class="status-text">Êú™ËøûÊé•</span>
                </div>
            </div>
            
            <div class="header-right">
                <button class="btn btn-icon" id="theme-toggle" title="ÂàáÊç¢‰∏ªÈ¢ò">üåì</button>
                <button class="btn btn-icon" id="fullscreen-toggle" title="ÂÖ®Â±èÊ®°Âºè (F11)">‚õ∂</button>
                <button class="btn btn-primary" id="save-btn" title="‰øùÂ≠òÂà∞ GitHub (Ctrl+S)">üíæ ‰øùÂ≠ò</button>
            </div>
        </header>

        <!-- ÂÖ®Â±èÂ∑•ÂÖ∑Ê†è -->
        <div class="fullscreen-toolbar">
            <div class="toolbar-section">
                <button class="btn btn-outline" id="fullscreen-format-btn">üîß Ê†ºÂºèÂåñ</button>
                <button class="btn btn-outline" id="fullscreen-validate-btn">‚úÖ È™åËØÅ</button>
                <button class="btn btn-outline" id="fullscreen-find-btn">üîç Êü•Êâæ</button>
            </div>
            <div class="toolbar-section">
                <button class="btn btn-icon" id="exit-fullscreen-btn" title="ÈÄÄÂá∫ÂÖ®Â±è (Esc)">üóó</button>
            </div>
        </div>

        <!-- Â∑•ÂÖ∑Ê†è -->
        <nav class="toolbar">
            <div class="toolbar-section">
                <div class="json-selector">
                    <select id="json-file-select">
                        <option value="">Ê≠£Âú®Âä†ËΩΩJSONÊñá‰ª∂...</option>
                    </select>
                </div>
                <button class="btn btn-secondary" id="refresh-files-btn" title="Âà∑Êñ∞Êñá‰ª∂ÂàóË°®">üîÑ</button>
            </div>
            
            <div class="toolbar-section">
                <button class="btn btn-secondary" id="upload-btn" title="‰∏ä‰º†JSONÊñá‰ª∂">üì§ ‰∏ä‰º†</button>
                <button class="btn btn-secondary" id="download-btn" title="‰∏ãËΩΩJSONÊñá‰ª∂">üì• ‰∏ãËΩΩ</button>
            </div>
            
            <div class="toolbar-section">
                <button class="btn btn-outline" id="format-btn" title="Ê†ºÂºèÂåñJSON (Ctrl+Shift+F)">üîß Ê†ºÂºèÂåñ</button>
                <button class="btn btn-outline" id="compress-btn" title="ÂéãÁº©JSON">üì¶ ÂéãÁº©</button>
                <button class="btn btn-outline" id="validate-btn" title="È™åËØÅJSON">‚úÖ È™åËØÅ</button>
            </div>
            
            <div class="toolbar-section">
                <button class="btn btn-outline" id="copy-btn" title="Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø (Ctrl+C)">üìã Â§çÂà∂</button>
                <button class="btn btn-outline" id="find-btn" title="Êü•ÊâæÂÜÖÂÆπ (Ctrl+F)">üîç Êü•Êâæ</button>
                <button class="btn btn-outline" id="undo-btn" disabled title="Êí§ÈîÄ (Ctrl+Z)">‚Ü∂ Êí§ÈîÄ</button>
                <button class="btn btn-outline" id="redo-btn" disabled title="ÈáçÂÅö (Ctrl+Y)">‚Ü∑ ÈáçÂÅö</button>
            </div>
        </nav>

        <!-- GitHub Token ËæìÂÖ• -->
        <div id="token-section" class="token-section">
            <div class="token-input-group">
                <label for="github-token">üîë GitHub Personal Access Token</label>
                <div class="input-with-button">
                    <input 
                        type="password" 
                        id="github-token" 
                        placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑ GitHub TokenÔºàÈúÄË¶Å repo ÊùÉÈôêÔºâ" 
                        autocomplete="current-password"
                    >
                    <button class="btn btn-primary" id="connect-btn">ËøûÊé• GitHub</button>
                </div>
                <div class="help-text">
                    ÈúÄË¶Å <code>repo</code> ÊùÉÈôê„ÄÇ<a href="https://github.com/settings/tokens" target="_blank">Â¶Ç‰ΩïËé∑Âèñ Token</a> | 
                    <a href="#" id="demo-mode">‰ΩøÁî®ÊºîÁ§∫Ê®°Âºè</a>
                </div>
            </div>
        </div>

        <!-- ‰∏ªÁºñËæëÂå∫ -->
        <main class="main-content">
            <div class="editor-header">
                <div class="current-file" id="current-file">
                    üìÑ Êú™ÈÄâÊã©Êñá‰ª∂
                </div>
                <div class="editor-actions">
                    <button class="btn btn-outline btn-sm" id="toggle-history" title="ÂàáÊç¢ÂéÜÂè≤ËÆ∞ÂΩï">üìö</button>
                    <button class="btn btn-outline btn-sm" id="editor-find-btn" title="Âú®ÁºñËæëÂô®‰∏≠Êü•Êâæ">üîç</button>
                </div>
            </div>
            
            <!-- Êü•ÊâæÊ†è -->
            <div class="search-bar" id="search-bar">
                <input type="text" id="search-input" placeholder="ËæìÂÖ•Ë¶ÅÊü•ÊâæÁöÑÂÜÖÂÆπ...">
                <button class="btn btn-outline btn-sm" id="search-prev" title="‰∏ä‰∏Ä‰∏™ÂåπÈÖçÈ°π">‚Üë</button>
                <button class="btn btn-outline btn-sm" id="search-next" title="‰∏ã‰∏Ä‰∏™ÂåπÈÖçÈ°π">‚Üì</button>
                <span class="search-info" id="search-info">0/0</span>
                <button class="btn btn-outline btn-sm" id="search-close" title="ÂÖ≥Èó≠Êü•Êâæ">‚úï</button>
            </div>
            
            <textarea id="editor" class="editor" placeholder="ËØ∑ÈÄâÊã©Êàñ‰∏ä‰º† JSON Êñá‰ª∂ÂºÄÂßãÁºñËæë...

ÊÇ®‰πüÂèØ‰ª•Áõ¥Êé•Âú®ËøôÈáåËæìÂÖ• JSON ÂÜÖÂÆπ„ÄÇ

Á§∫‰æãÊ†ºÂºèÔºö
{
  &quot;sites&quot;: [],
  &quot;wallpaper&quot;: &quot;&quot;,
  &quot;spider&quot;: &quot;&quot;,
  &quot;warningText&quot;: &quot;&quot;,
  &quot;disclaimer&quot;: &quot;&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;
}"></textarea>
            
            <!-- ÈîôËØØÈù¢Êùø -->
            <div id="error-panel" class="error-panel" style="display: none;">
                <div class="error-header">
                    <span>‚ö†Ô∏è JSON Ê†ºÂºèÈîôËØØ</span>
                    <button class="error-close" id="close-error">‚úï</button>
                </div>
                <div class="error-content" id="error-message"></div>
            </div>
        </main>

        <!-- ÂéÜÂè≤ËÆ∞ÂΩï‰æßËæπÊ†è -->
        <aside class="history-sidebar" id="history-sidebar">
            <div class="history-header">
                <h3>üìö ÂéÜÂè≤ËÆ∞ÂΩï</h3>
                <button class="btn btn-icon" id="close-history" style="color: white;" title="ÂÖ≥Èó≠ÂéÜÂè≤ËÆ∞ÂΩï">‚úï</button>
            </div>
            
            <div class="history-content">
                <div class="history-controls">
                    <button class="btn btn-outline btn-sm" id="clear-history" title="Ê∏ÖÈô§ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩï">üóëÔ∏è Ê∏ÖÈô§</button>
                    <button class="btn btn-outline btn-sm" id="export-history" title="ÂØºÂá∫ÂéÜÂè≤ËÆ∞ÂΩï">üì• ÂØºÂá∫</button>
                </div>
                
                <div class="history-list" id="history-list">
                    <div class="history-empty">
                        ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï
                        <br><small>ÁºñËæëÂÜÖÂÆπÂêéÂ∞ÜËá™Âä®ÁîüÊàêÂéÜÂè≤ËÆ∞ÂΩï</small>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Áä∂ÊÄÅÊ†è -->
        <footer class="status-bar">
            <div class="status-left">
                <span id="cursor-position">Ë°å 1, Âàó 1</span>
                <span id="file-size">0 Â≠óÁ¨¶</span>
                <span id="encoding">UTF-8</span>
                <span id="auto-save-status">Ëá™Âä®‰øùÂ≠ò: ÂºÄÂêØ</span>
            </div>
            
            <div class="status-right">
                <span id="last-saved">Êú™‰øùÂ≠ò</span>
                <span id="json-status" class="status-valid">JSON Ê†ºÂºèÊ≠£Â∏∏</span>
            </div>
        </footer>
    </div>

    <!-- ToastÈÄöÁü•ÂÆπÂô® -->
    <div id="toast-container" class="toast-container"></div>

    <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• -->
    <input type="file" id="file-input" accept=".json,application/json" style="display: none;">

    <script>
        // Luna TV ÈÖçÁΩÆÁºñËæëÂô® - ÂÆåÊï¥JavaScript‰ª£Á†Å
        class LunaTVEditor {
            constructor() {
                this.isConnected = false;
                this.currentTheme = 'dark';
                this.history = [];
                this.historyIndex = -1;
                this.autoSaveInterval = null;
                this.lastContent = '';
                this.isFullscreen = false;
                this.jsonFiles = [];
                this.currentFile = null;
                this.searchMatches = [];
                this.currentSearchIndex = -1;
                this.githubToken = null;
                this.repoOwner = 'hafrey1';
                this.repoName = 'LunaTV-config';
            }
            
            async init() {
                try {
                    console.log('üåô ÂàùÂßãÂåñ Luna TV ÈÖçÁΩÆÁºñËæëÂô®...');
                    
                    this.setupEventListeners();
                    this.loadSettings();
                    this.startAutoSave();
                    this.updateStatus();
                    
                    // Ê£ÄÊü•ÊòØÂê¶Êúâ‰øùÂ≠òÁöÑtoken
                    const savedToken = localStorage.getItem('lunatv_github_token');
                    if (savedToken) {
                        this.githubToken = savedToken;
                        document.getElementById('github-token').value = savedToken;
                        await this.connectGitHub();
                    } else {
                        // Ê≤°ÊúâtokenÔºåÁõ¥Êé•ËøõÂÖ•ÊºîÁ§∫Ê®°Âºè
                        await this.enterDemoMode();
                    }
                    
                    this.hideLoading();
                    console.log('‚ú® Luna TV ÈÖçÁΩÆÁºñËæëÂô®ÂêØÂä®ÂÆåÊàê');
                    
                } catch (error) {
                    console.error('ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                    this.hideLoading();
                    this.showToast('ÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message, 'error');
                }
            }
            
            hideLoading() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('app').style.display = 'grid';
            }
            
            setupEventListeners() {
                const editor = document.getElementById('editor');
                
                // ÁºñËæëÂô®‰∫ã‰ª∂
                editor.addEventListener('input', () => this.onContentChange());
                editor.addEventListener('keydown', (e) => this.handleKeyDown(e));
                editor.addEventListener('scroll', () => this.updateCursorPosition());
                editor.addEventListener('click', () => this.updateCursorPosition());
                editor.addEventListener('keyup', () => this.updateCursorPosition());
                
                // Â∑•ÂÖ∑Ê†èÊåâÈíÆ
                document.getElementById('refresh-files-btn').onclick = () => this.loadJSONFiles();
                document.getElementById('upload-btn').onclick = () => this.uploadFile();
                document.getElementById('download-btn').onclick = () => this.downloadFile();
                document.getElementById('format-btn').onclick = () => this.formatJSON();
                document.getElementById('compress-btn').onclick = () => this.compressJSON();
                document.getElementById('validate-btn').onclick = () => this.validateJSON();
                document.getElementById('copy-btn').onclick = () => this.copyToClipboard();
                document.getElementById('find-btn').onclick = () => this.showFind();
                document.getElementById('editor-find-btn').onclick = () => this.showFind();
                document.getElementById('undo-btn').onclick = () => this.undo();
                document.getElementById('redo-btn').onclick = () => this.redo();
                
                // Â§¥ÈÉ®ÊåâÈíÆ
                document.getElementById('save-btn').onclick = () => this.saveToGitHub();
                document.getElementById('theme-toggle').onclick = () => this.toggleTheme();
                document.getElementById('fullscreen-toggle').onclick = () => this.toggleFullscreen();
                
                // ÂÖ®Â±èÂ∑•ÂÖ∑Ê†èÊåâÈíÆ
                document.getElementById('fullscreen-format-btn').onclick = () => this.formatJSON();
                document.getElementById('fullscreen-validate-btn').onclick = () => this.validateJSON();
                document.getElementById('fullscreen-find-btn').onclick = () => this.showFind();
                document.getElementById('exit-fullscreen-btn').onclick = () => this.toggleFullscreen();
                
                // GitHubËøûÊé•
                document.getElementById('connect-btn').onclick = () => this.connectGitHub();
                document.getElementById('demo-mode').onclick = (e) => {
                    e.preventDefault();
                    this.enterDemoMode();
                };
                
                // Êñá‰ª∂ÈÄâÊã©
                document.getElementById('json-file-select').onchange = (e) => this.selectJSONFile(e.target.value);
                document.getElementById('file-input').onchange = (e) => this.handleFileUpload(e);
                
                // ÂÖ≥Èó≠ÊåâÈíÆ
                document.getElementById('close-error').onclick = () => this.hideError();
                document.getElementById('close-history').onclick = () => this.toggleHistory();
                
                // ÂéÜÂè≤ËÆ∞ÂΩï
                document.getElementById('toggle-history').onclick = () => this.toggleHistory();
                document.getElementById('clear-history').onclick = () => this.clearHistory();
                document.getElementById('export-history').onclick = () => this.exportHistory();
                
                // Êü•ÊâæÂäüËÉΩ
                document.getElementById('search-input').addEventListener('input', (e) => this.performSearch(e.target.value));
                document.getElementById('search-prev').onclick = () => this.searchPrevious();
                document.getElementById('search-next').onclick = () => this.searchNext();
                document.getElementById('search-close').onclick = () => this.hideFind();
                
                // Êü•ÊâæÊ†èÈîÆÁõò‰∫ã‰ª∂
                document.getElementById('search-input').addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (e.shiftKey) {
                            this.searchPrevious();
                        } else {
                            this.searchNext();
                        }
                    } else if (e.key === 'Escape') {
                        this.hideFind();
                    }
                });
                
                // ÂÖ®Â±ÄÈîÆÁõò‰∫ã‰ª∂
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        this.hideFind();
                        if (this.isFullscreen) {
                            this.toggleFullscreen();
                        }
                    }
                });
            }
            
            onContentChange() {
                const content = document.getElementById('editor').value;
                this.updateFileSize(content);
                this.validateJSON();
                
                if (content !== this.lastContent) {
                    this.saveToHistory(content);
                    this.lastContent = content;
                    this.updateSaveStatus(false);
                }
            }
            
            handleKeyDown(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch (e.key) {
                        case 's':
                            e.preventDefault();
                            this.saveToGitHub();
                            break;
                        case 'f':
                            e.preventDefault();
                            this.showFind();
                            break;
                        case 'z':
                            if (e.shiftKey) {
                                e.preventDefault();
                                this.redo();
                            } else {
                                e.preventDefault();
                                this.undo();
                            }
                            break;
                        case 'y':
                            e.preventDefault();
                            this.redo();
                            break;
                    }
                }
                
                if (e.ctrlKey && e.shiftKey && e.key === 'F') {
                    e.preventDefault();
                    this.formatJSON();
                }
                
                if (e.key === 'F11') {
                    e.preventDefault();
                    this.toggleFullscreen();
                }
            }
            
            // GitHub API ÈõÜÊàê
            async connectGitHub() {
                const token = document.getElementById('github-token').value.trim();
                if (!token) {
                    this.showToast('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑ GitHub Token', 'error');
                    return;
                }
                
                try {
                    this.showToast('Ê≠£Âú®ËøûÊé• GitHub...', 'info');
                    
                    // ÊµãËØï GitHub API ËøûÊé•
                    const response = await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}`, {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`GitHub API ÈîôËØØ: ${response.status} ${response.statusText}`);
                    }
                    
                    const repoData = await response.json();
                    
                    this.githubToken = token;
                    this.isConnected = true;
                    this.updateConnectionStatus();
                    
                    localStorage.setItem('lunatv_github_token', token);
                    this.showToast('GitHub ËøûÊé•ÊàêÂäü', 'success');
                    
                    // Âä†ËΩΩJSONÊñá‰ª∂ÂàóË°®
                    await this.loadJSONFiles();
                    
                } catch (error) {
                    console.error('GitHub ËøûÊé•Â§±Ë¥•:', error);
                    this.showToast('GitHub ËøûÊé•Â§±Ë¥•: ' + error.message, 'error');
                }
            }
            
            async enterDemoMode() {
                this.isConnected = true;
                this.updateConnectionStatus();
                this.showToast('Â∑≤ËøõÂÖ•ÊºîÁ§∫Ê®°ÂºèÔºåÂèØÊü•ÁúãÁ§∫‰æãÊñá‰ª∂', 'info');
                
                // ÈöêËóètokenËæìÂÖ•Âå∫
                document.getElementById('token-section').style.display = 'none';
                
                // Âä†ËΩΩÊºîÁ§∫Êï∞ÊçÆ
                await this.loadDemoFiles();
            }
            
            async loadDemoFiles() {
                // ÊºîÁ§∫Ê®°ÂºèÁöÑÊ†∑‰æãÊñá‰ª∂
                this.jsonFiles = [
                    { name: 'luna-tv-config.json', path: 'luna-tv-config.json', type: 'demo' },
                    { name: 'jinhuang.json', path: 'jinhuang.json', type: 'demo' },
                    { name: 'ÈÖçÁΩÆÁ§∫‰æã.json', path: 'config-example.json', type: 'demo' }
                ];
                
                this.updateFileSelector();
            }
            
            async loadJSONFiles() {
                if (!this.isConnected || !this.githubToken) {
                    await this.loadDemoFiles();
                    return;
                }
                
                try {
                    this.showToast('Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂ÂàóË°®...', 'info');
                    
                    const response = await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}/contents`, {
                        headers: {
                            'Authorization': `token ${this.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Ëé∑ÂèñÊñá‰ª∂ÂàóË°®Â§±Ë¥•: ${response.status}`);
                    }
                    
                    const files = await response.json();
                    
                    // Á≠õÈÄâJSONÊñá‰ª∂
                    this.jsonFiles = files
                        .filter(file => file.name.toLowerCase().endsWith('.json'))
                        .map(file => ({
                            name: file.name,
                            path: file.path,
                            sha: file.sha,
                            size: file.size,
                            type: 'github'
                        }));
                    
                    this.updateFileSelector();
                    this.showToast(`Â∑≤Âä†ËΩΩ ${this.jsonFiles.length} ‰∏™ JSON Êñá‰ª∂`, 'success');
                    
                } catch (error) {
                    console.error('Âä†ËΩΩJSONÊñá‰ª∂ÂàóË°®Â§±Ë¥•:', error);
                    this.showToast('Âä†ËΩΩÊñá‰ª∂ÂàóË°®Â§±Ë¥•: ' + error.message, 'error');
                    // ÈôçÁ∫ßÂà∞ÊºîÁ§∫Ê®°Âºè
                    await this.loadDemoFiles();
                }
            }
            
            updateFileSelector() {
                const select = document.getElementById('json-file-select');
                select.innerHTML = '<option value="">ÈÄâÊã© JSON Êñá‰ª∂...</option>';
                
                this.jsonFiles.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file.path;
                    const sizeText = file.size ? ` (${this.formatFileSize(file.size)})` : '';
                    option.textContent = `${file.name}${sizeText}`;
                    select.appendChild(option);
                });
                
                if (this.jsonFiles.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'Êú™ÊâæÂà∞ JSON Êñá‰ª∂';
                    option.disabled = true;
                    select.appendChild(option);
                }
            }
            
            formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            }
            
            async selectJSONFile(filePath) {
                if (!filePath) {
                    this.currentFile = null;
                    document.getElementById('current-file').innerHTML = 'üìÑ Êú™ÈÄâÊã©Êñá‰ª∂';
                    return;
                }
                
                try {
                    this.showToast('Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂...', 'info');
                    
                    const file = this.jsonFiles.find(f => f.path === filePath);
                    if (!file) {
                        throw new Error('Êñá‰ª∂‰∏çÂ≠òÂú®');
                    }
                    
                    let content;
                    
                    if (file.type === 'demo') {
                        // ÊºîÁ§∫Ê®°ÂºèÊï∞ÊçÆ
                        content = this.getDemoContent(filePath);
                    } else {
                        // ‰ªé GitHub Âä†ËΩΩ
                        const response = await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}/contents/${filePath}`, {
                            headers: {
                                'Authorization': `token ${this.githubToken}`,
                                'Accept': 'application/vnd.github.v3.raw'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•: ${response.status}`);
                        }
                        
                        content = await response.text();
                    }
                    
                    this.currentFile = file;
                    document.getElementById('current-file').innerHTML = `üìÑ ${file.name}`;
                    document.getElementById('editor').value = content;
                    this.onContentChange();
                    
                    this.showToast(`Â∑≤Âä†ËΩΩÊñá‰ª∂: ${file.name}`, 'success');
                    
                } catch (error) {
                    console.error('Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•:', error);
                    this.showToast('Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•: ' + error.message, 'error');
                }
            }
            
            getDemoContent(filePath) {
                const demoContents = {
                    'luna-tv-config.json': {
                        "sites": [
                            {
                                "key": "csp_AppYsV2",
                                "name": "AppYs",
                                "type": 3,
                                "api": "csp_AppYsV2",
                                "searchable": 1,
                                "quickSearch": 1,
                                "filterable": 1,
                                "ext": "https://raw.githubusercontent.com/hafrey1/LunaTV-config/main/luna-tv-config.json"
                            }
                        ],
                        "wallpaper": "https://picsum.photos/1920/1080",
                        "spider": "https://raw.githubusercontent.com/hafrey1/LunaTV-config/main/js/spider.jar",
                        "warningText": "Êú¨Â∫îÁî®‰ªÖ‰æõÂ≠¶‰π†‰∫§ÊµÅ‰ΩøÁî®",
                        "disclaimer": "ÂÖçË¥£Â£∞ÊòéÂÜÖÂÆπ",
                        "version": "2.0.0"
                    },
                    'jinhuang.json': {
                        "sites": [
                            {
                                "key": "csp_XYQHiker",
                                "name": "È¶ôÈõÖÊÉÖ",
                                "type": 3,
                                "api": "csp_XYQHiker",
                                "searchable": 1,
                                "quickSearch": 1,
                                "filterable": 1
                            }
                        ],
                        "wallpaper": "https://picsum.photos/1920/1080",
                        "spider": "https://raw.githubusercontent.com/hafrey1/LunaTV-config/main/js/spider.jar",
                        "warningText": "Êú¨Â∫îÁî®‰ªÖ‰æõÂ≠¶‰π†‰∫§ÊµÅ‰ΩøÁî®",
                        "disclaimer": "ÂÖçË¥£Â£∞ÊòéÂÜÖÂÆπ",
                        "version": "1.5.0"
                    },
                    'config-example.json': {
                        "app_name": "Luna TV",
                        "version": "2.0.0",
                        "author": "hafrey1",
                        "repository": "https://github.com/hafrey1/LunaTV-config",
                        "settings": {
                            "auto_update": true,
                            "cache_size": 100,
                            "max_concurrent_requests": 5
                        },
                        "features": [
                            "Â§öÊ∫êËÅöÂêà",
                            "Êô∫ËÉΩÊêúÁ¥¢",
                            "Âú®Á∫øÊí≠Êîæ",
                            "Á¶ªÁ∫øÁºìÂ≠ò"
                        ]
                    }
                };
                
                const content = demoContents[filePath];
                return content ? JSON.stringify(content, null, 2) : '{\n  "message": "ÊºîÁ§∫Êï∞ÊçÆ"\n}';
            }
            
            // JSON Êìç‰ΩúÊñπÊ≥ï
            formatJSON() {
                try {
                    const content = document.getElementById('editor').value;
                    if (!content.trim()) {
                        this.showToast('ËØ∑ËæìÂÖ• JSON ÂÜÖÂÆπ', 'warning');
                        return;
                    }
                    
                    const parsed = JSON.parse(content);
                    const formatted = JSON.stringify(parsed, null, 2);
                    document.getElementById('editor').value = formatted;
                    this.onContentChange();
                    this.showToast('JSON Ê†ºÂºèÂåñÊàêÂäü', 'success');
                } catch (e) {
                    this.showToast('JSON Ê†ºÂºèÂåñÂ§±Ë¥•: ' + e.message, 'error');
                }
            }
            
            compressJSON() {
                try {
                    const content = document.getElementById('editor').value;
                    if (!content.trim()) {
                        this.showToast('ËØ∑ËæìÂÖ• JSON ÂÜÖÂÆπ', 'warning');
                        return;
                    }
                    
                    const parsed = JSON.parse(content);
                    const compressed = JSON.stringify(parsed);
                    document.getElementById('editor').value = compressed;
                    this.onContentChange();
                    this.showToast('JSON ÂéãÁº©ÊàêÂäü', 'success');
                } catch (e) {
                    this.showToast('JSON ÂéãÁº©Â§±Ë¥•: ' + e.message, 'error');
                }
            }
            
            validateJSON() {
                const content = document.getElementById('editor').value;
                const jsonStatus = document.getElementById('json-status');
                
                if (!content.trim()) {
                    jsonStatus.textContent = 'Êó†ÂÜÖÂÆπ';
                    jsonStatus.className = 'status-invalid';
                    return false;
                }
                
                try {
                    JSON.parse(content);
                    jsonStatus.textContent = 'JSON Ê†ºÂºèÊ≠£Â∏∏';
                    jsonStatus.className = 'status-valid';
                    this.hideError();
                    return true;
                } catch (e) {
                    jsonStatus.textContent = 'JSON Ê†ºÂºèÈîôËØØ';
                    jsonStatus.className = 'status-invalid';
                    this.showError('Ê†ºÂºèÈîôËØØ: ' + e.message);
                    return false;
                }
            }
            
            async copyToClipboard() {
                try {
                    const content = document.getElementById('editor').value;
                    if (!content.trim()) {
                        this.showToast('Êó†ÂÜÖÂÆπÂèØÂ§çÂà∂', 'warning');
                        return;
                    }
                    
                    await navigator.clipboard.writeText(content);
                    this.showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                } catch (e) {
                    // Â§áÁî®ÊñπÊ°à
                    const editor = document.getElementById('editor');
                    editor.select();
                    document.execCommand('copy');
                    this.showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                }
            }
            
            // Êü•ÊâæÂäüËÉΩ
            showFind() {
                const searchBar = document.getElementById('search-bar');
                const searchInput = document.getElementById('search-input');
                
                searchBar.style.display = 'flex';
                searchInput.focus();
                
                // Â¶ÇÊûúÊúâÈÄâ‰∏≠ÊñáÊú¨ÔºåËá™Âä®Â°´ÂÖ•Êü•ÊâæÊ°Ü
                const editor = document.getElementById('editor');
                const selectedText = editor.value.substring(editor.selectionStart, editor.selectionEnd);
                if (selectedText && selectedText.length < 100) {
                    searchInput.value = selectedText;
                    this.performSearch(selectedText);
                }
            }
            
            hideFind() {
                const searchBar = document.getElementById('search-bar');
                searchBar.style.display = 'none';
                this.clearSearchHighlight();
                document.getElementById('editor').focus();
            }
            
            performSearch(query) {
                const editor = document.getElementById('editor');
                const content = editor.value;
                this.searchMatches = [];
                
                if (!query || !content) {
                    this.updateSearchInfo();
                    return;
                }
                
                // Êü•ÊâæÊâÄÊúâÂåπÈÖçÈ°π
                let index = content.toLowerCase().indexOf(query.toLowerCase());
                while (index !== -1) {
                    this.searchMatches.push({ start: index, end: index + query.length });
                    index = content.toLowerCase().indexOf(query.toLowerCase(), index + 1);
                }
                
                this.currentSearchIndex = this.searchMatches.length > 0 ? 0 : -1;
                this.updateSearchInfo();
                
                if (this.searchMatches.length > 0) {
                    this.jumpToSearchMatch(0);
                }
            }
            
            searchNext() {
                if (this.searchMatches.length === 0) return;
                
                this.currentSearchIndex = (this.currentSearchIndex + 1) % this.searchMatches.length;
                this.jumpToSearchMatch(this.currentSearchIndex);
                this.updateSearchInfo();
            }
            
            searchPrevious() {
                if (this.searchMatches.length === 0) return;
                
                this.currentSearchIndex = this.currentSearchIndex === 0 ? 
                    this.searchMatches.length - 1 : this.currentSearchIndex - 1;
                this.jumpToSearchMatch(this.currentSearchIndex);
                this.updateSearchInfo();
            }
            
            jumpToSearchMatch(index) {
                if (index < 0 || index >= this.searchMatches.length) return;
                
                const editor = document.getElementById('editor');
                const match = this.searchMatches[index];
                
                editor.focus();
                editor.setSelectionRange(match.start, match.end);
                
                // ÊªöÂä®Âà∞ÂèØËßÅÂå∫Âüü
                const lines = editor.value.substring(0, match.start).split('\n');
                const lineNumber = lines.length;
                const lineHeight = 20; // ‰º∞ÁÆóË°åÈ´ò
                const scrollTop = Math.max(0, (lineNumber - 10) * lineHeight);
                editor.scrollTop = scrollTop;
            }
            
            updateSearchInfo() {
                const searchInfo = document.getElementById('search-info');
                if (this.searchMatches.length === 0) {
                    searchInfo.textContent = '0/0';
                } else {
                    searchInfo.textContent = `${this.currentSearchIndex + 1}/${this.searchMatches.length}`;
                }
            }
            
            clearSearchHighlight() {
                this.searchMatches = [];
                this.currentSearchIndex = -1;
                this.updateSearchInfo();
            }
            
            // Êí§ÈîÄÈáçÂÅö
            undo() {
                if (this.historyIndex > 0) {
                    this.historyIndex--;
                    document.getElementById('editor').value = this.history[this.historyIndex];
                    this.updateUndoRedoButtons();
                    this.showToast('Â∑≤Êí§ÈîÄ', 'info');
                    this.onContentChange();
                }
            }
            
            redo() {
                if (this.historyIndex < this.history.length - 1) {
                    this.historyIndex++;
                    document.getElementById('editor').value = this.history[this.historyIndex];
                    this.updateUndoRedoButtons();
                    this.showToast('Â∑≤ÈáçÂÅö', 'info');
                    this.onContentChange();
                }
            }
            
            // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
            saveToHistory(content) {
                // Â¶ÇÊûúÂÜÖÂÆπÁõ∏ÂêåÔºå‰∏ç‰øùÂ≠ò
                if (this.history[this.historyIndex] === content) return;
                
                // ÁßªÈô§ÂΩìÂâç‰ΩçÁΩÆ‰πãÂêéÁöÑÂéÜÂè≤ËÆ∞ÂΩï
                this.history = this.history.slice(0, this.historyIndex + 1);
                
                // Ê∑ªÂä†Êñ∞ËÆ∞ÂΩï
                this.history.push(content);
                
                // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
                if (this.history.length > 50) {
                    this.history.shift();
                } else {
                    this.historyIndex++;
                }
                
                this.updateUndoRedoButtons();
                this.updateHistoryPanel();
                
                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                localStorage.setItem('lunatv_history', JSON.stringify({
                    history: this.history,
                    index: this.historyIndex
                }));
            }
            
            // Êõ¥Êñ∞Êí§ÈîÄÈáçÂÅöÊåâÈíÆÁä∂ÊÄÅ
            updateUndoRedoButtons() {
                document.getElementById('undo-btn').disabled = this.historyIndex <= 0;
                document.getElementById('redo-btn').disabled = this.historyIndex >= this.history.length - 1;
            }
            
            // ÂÖ®Â±èÂäüËÉΩ
            toggleFullscreen() {
                const app = document.getElementById('app');
                this.isFullscreen = !this.isFullscreen;
                
                if (this.isFullscreen) {
                    app.classList.add('fullscreen');
                    document.getElementById('fullscreen-toggle').textContent = 'üóó';
                } else {
                    app.classList.remove('fullscreen');
                    document.getElementById('fullscreen-toggle').textContent = '‚õ∂';
                }
            }
            
            // ‰∏ªÈ¢òÂàáÊç¢
            toggleTheme() {
                this.currentTheme = this.currentTheme === 'dark' ? 'light' : 'dark';
                document.body.setAttribute('data-theme', this.currentTheme);
                localStorage.setItem('lunatv_theme', this.currentTheme);
                this.showToast(`Â∑≤ÂàáÊç¢Âà∞${this.currentTheme === 'dark' ? 'Ê∑±Ëâ≤' : 'ÊµÖËâ≤'}‰∏ªÈ¢ò`, 'info');
            }
            
            // ÂéÜÂè≤ËÆ∞ÂΩïÁÆ°ÁêÜ
            toggleHistory() {
                const sidebar = document.getElementById('history-sidebar');
                const isVisible = window.innerWidth <= 1024 ? 
                    sidebar.classList.contains('active') : true;
                
                if (window.innerWidth <= 1024) {
                    sidebar.classList.toggle('active');
                } else {
                    // Ê°åÈù¢Á´Ø‰∏çÈúÄË¶ÅÂàáÊç¢ÔºåÂéÜÂè≤ËÆ∞ÂΩïÂßãÁªàÊòæÁ§∫
                }
                
                this.updateHistoryPanel();
            }
            
            updateHistoryPanel() {
                const list = document.getElementById('history-list');
                list.innerHTML = '';
                
                if (this.history.length === 0) {
                    list.innerHTML = '<div class="history-empty">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï<br><small>ÁºñËæëÂÜÖÂÆπÂêéÂ∞ÜËá™Âä®ÁîüÊàêÂéÜÂè≤ËÆ∞ÂΩï</small></div>';
                    return;
                }
                
                this.history.slice().reverse().forEach((content, reverseIndex) => {
                    const index = this.history.length - 1 - reverseIndex;
                    const item = document.createElement('div');
                    item.className = 'history-item';
                    
                    if (index === this.historyIndex) {
                        item.classList.add('active');
                    }
                    
                    const preview = content.substring(0, 100).replace(/\n/g, ' ');
                    const time = new Date(Date.now() - (reverseIndex * 60000)).toLocaleString();
                    
                    item.innerHTML = `
                        <div class="history-time">ÁâàÊú¨ ${index + 1} - ${time}</div>
                        <div class="history-preview">${preview}${content.length > 100 ? '...' : ''}</div>
                    `;
                    
                    item.onclick = () => {
                        document.getElementById('editor').value = content;
                        this.historyIndex = index;
                        this.updateUndoRedoButtons();
                        this.updateHistoryPanel();
                        this.onContentChange();
                        this.showToast('Â∑≤ÊÅ¢Â§çÂéÜÂè≤ÁâàÊú¨', 'success');
                    };
                    
                    list.appendChild(item);
                });
            }
            
            clearHistory() {
                if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÂéÜÂè≤ËÆ∞ÂΩïÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄ„ÄÇ')) {
                    this.history = [];
                    this.historyIndex = -1;
                    this.updateUndoRedoButtons();
                    this.updateHistoryPanel();
                    localStorage.removeItem('lunatv_history');
                    this.showToast('ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤Ê∏ÖÈô§', 'info');
                }
            }
            
            exportHistory() {
                if (this.history.length === 0) {
                    this.showToast('Ê≤°ÊúâÂéÜÂè≤ËÆ∞ÂΩïÂèØÂØºÂá∫', 'warning');
                    return;
                }
                
                const data = {
                    exported_at: new Date().toISOString(),
                    history: this.history,
                    current_index: this.historyIndex
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lunatv-history-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showToast('ÂéÜÂè≤ËÆ∞ÂΩïÂ∑≤ÂØºÂá∫', 'success');
            }
            
            // GitHub ‰øùÂ≠ò
            async saveToGitHub() {
                if (!this.isConnected) {
                    this.showToast('ËØ∑ÂÖàËøûÊé• GitHub', 'error');
                    return;
                }
                
                const content = document.getElementById('editor').value;
                if (!this.validateJSON()) {
                    this.showToast('‰øùÂ≠òÂ§±Ë¥•: JSON Ê†ºÂºèÊó†Êïà', 'error');
                    return;
                }
                
                if (!this.currentFile) {
                    this.showToast('ËØ∑ÂÖàÈÄâÊã©Ë¶Å‰øùÂ≠òÁöÑÊñá‰ª∂', 'error');
                    return;
                }
                
                if (this.currentFile.type === 'demo') {
                    this.showToast('ÊºîÁ§∫Ê®°Âºè‰∏ãÊó†Ê≥ï‰øùÂ≠òÂà∞ GitHub', 'warning');
                    return;
                }
                
                try {
                    this.showToast('Ê≠£Âú®‰øùÂ≠òÂà∞ GitHub...', 'info');
                    
                    const response = await fetch(`https://api.github.com/repos/${this.repoOwner}/${this.repoName}/contents/${this.currentFile.path}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${this.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update ${this.currentFile.name}`,
                            content: btoa(unescape(encodeURIComponent(content))),
                            sha: this.currentFile.sha
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`‰øùÂ≠òÂ§±Ë¥•: ${response.status} ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.currentFile.sha = result.content.sha;
                    
                    this.updateSaveStatus(true);
                    this.showToast(`ÈÖçÁΩÆÂ∑≤‰øùÂ≠òÂà∞ GitHub: ${this.currentFile.name}`, 'success');
                    
                } catch (error) {
                    console.error('‰øùÂ≠òÂà∞ GitHub Â§±Ë¥•:', error);
                    this.showToast('‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
                }
            }
            
            // Êñá‰ª∂Êìç‰Ωú
            uploadFile() {
                document.getElementById('file-input').click();
            }
            
            handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result;
                    document.getElementById('editor').value = content;
                    this.onContentChange();
                    this.showToast(`Êñá‰ª∂ "${file.name}" ‰∏ä‰º†ÊàêÂäü`, 'success');
                    
                    // Êõ¥Êñ∞ÂΩìÂâçÊñá‰ª∂Âêç
                    this.currentFile = { name: file.name, type: 'local' };
                    document.getElementById('current-file').innerHTML = `üìÑ ${file.name}`;
                };
                reader.readAsText(file);
                
                // Ê∏ÖÁ©∫ËæìÂÖ•
                event.target.value = '';
            }
            
            downloadFile() {
                const content = document.getElementById('editor').value;
                const filename = this.currentFile ? this.currentFile.name : `luna-tv-config-${new Date().toISOString().split('T')[0]}.json`;
                
                const blob = new Blob([content], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showToast('Êñá‰ª∂‰∏ãËΩΩÊàêÂäü', 'success');
            }
            
            // ËøûÊé•Áä∂ÊÄÅÁÆ°ÁêÜ
            updateConnectionStatus() {
                const statusDot = document.querySelector('.status-dot');
                const statusText = document.querySelector('.status-text');
                const tokenSection = document.getElementById('token-section');
                
                if (this.isConnected) {
                    statusDot.classList.add('connected');
                    statusText.textContent = 'Â∑≤ËøûÊé•';
                    tokenSection.style.display = 'none';
                    
                    // ÂêØÁî®Áõ∏ÂÖ≥ÊåâÈíÆ
                    document.getElementById('save-btn').disabled = false;
                } else {
                    statusDot.classList.remove('connected');
                    statusText.textContent = 'Êú™ËøûÊé•';
                    tokenSection.style.display = 'block';
                    
                    // Á¶ÅÁî®Áõ∏ÂÖ≥ÊåâÈíÆ
                    document.getElementById('save-btn').disabled = true;
                }
            }
            
            // Ëá™Âä®‰øùÂ≠ò
            startAutoSave() {
                this.autoSaveInterval = setInterval(() => {
                    const content = document.getElementById('editor').value;
                    if (content !== this.lastContent && this.validateJSON()) {
                        localStorage.setItem('lunatv_autosave', content);
                        localStorage.setItem('lunatv_autosave_time', Date.now());
                        this.updateAutoSaveStatus('ÂàöÂàöËá™Âä®‰øùÂ≠ò');
                    }
                }, 30000); // 30ÁßíËá™Âä®‰øùÂ≠ò
            }
            
            updateAutoSaveStatus(text) {
                const status = document.getElementById('auto-save-status');
                if (status) {
                    status.textContent = `Ëá™Âä®‰øùÂ≠ò: ${text}`;
                    setTimeout(() => {
                        if (status.textContent.includes('ÂàöÂàö')) {
                            status.textContent = 'Ëá™Âä®‰øùÂ≠ò: ÂºÄÂêØ';
                        }
                    }, 3000);
                }
            }
            
            updateSaveStatus(saved) {
                const status = document.getElementById('last-saved');
                if (saved) {
                    status.textContent = 'Â∑≤‰øùÂ≠ò';
                    setTimeout(() => {
                        if (status.textContent === 'Â∑≤‰øùÂ≠ò') {
                            status.textContent = 'ÂàöÂàö‰øùÂ≠ò';
                        }
                    }, 2000);
                } else {
                    status.textContent = 'Êú™‰øùÂ≠ò';
                }
            }
            
            // Â∑•ÂÖ∑ÊñπÊ≥ï
            updateFileSize(content) {
                const size = new Blob([content]).size;
                const sizeElement = document.getElementById('file-size');
                if (sizeElement) {
                    if (size < 1024) {
                        sizeElement.textContent = `${size} Â≠óÁ¨¶`;
                    } else if (size < 1024 * 1024) {
                        sizeElement.textContent = `${(size / 1024).toFixed(1)} KB`;
                    } else {
                        sizeElement.textContent = `${(size / (1024 * 1024)).toFixed(1)} MB`;
                    }
                }
            }
            
            updateCursorPosition() {
                const editor = document.getElementById('editor');
                const position = editor.selectionStart;
                const content = editor.value.substring(0, position);
                const lines = content.split('\n');
                const line = lines.length;
                const column = lines[lines.length - 1].length + 1;
                
                document.getElementById('cursor-position').textContent = `Ë°å ${line}, Âàó ${column}`;
            }
            
            updateStatus() {
                // ÂàùÂßãÁä∂ÊÄÅ
                this.updateCursorPosition();
            }
            
            showError(message) {
                const errorPanel = document.getElementById('error-panel');
                const errorMessage = document.getElementById('error-message');
                
                errorMessage.textContent = message;
                errorPanel.style.display = 'block';
            }
            
            hideError() {
                document.getElementById('error-panel').style.display = 'none';
            }
            
            showToast(message, type = 'info', duration = 3000) {
                const container = document.getElementById('toast-container');
                const toast = document.createElement('div');
                
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                container.appendChild(toast);
                
                // ÁÇπÂáªÂÖ≥Èó≠
                toast.onclick = () => toast.remove();
                
                // Ëá™Âä®ÂÖ≥Èó≠
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, duration);
            }

            
            // Âä†ËΩΩËÆæÁΩÆ
            loadSettings() {
                const theme = localStorage.getItem('lunatv_theme') || 'dark';
                this.currentTheme = theme;
                document.body.setAttribute('data-theme', theme);
                
                const viewMode = localStorage.getItem('lunatv_viewMode') || 'editor';
                document.getElementById('view-mode').value = viewMode;
                this.changeViewMode(viewMode);
                
                // Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï
                const historyData = localStorage.getItem('lunatv_history');
                if (historyData) {
                    try {
                        const parsed = JSON.parse(historyData);
                        this.history = parsed.history || [];
                        this.historyIndex = parsed.index || -1;
                        this.updateUndoRedoButtons();
                    } catch (e) {
                        console.warn('ÂéÜÂè≤ËÆ∞ÂΩïÂä†ËΩΩÂ§±Ë¥•:', e);
                    }
                }
                
                // Âä†ËΩΩËá™Âä®‰øùÂ≠òÁöÑÂÜÖÂÆπ
                const autoSaved = localStorage.getItem('lunatv_autosave');
                const autoSaveTime = localStorage.getItem('lunatv_autosave_time');
                if (autoSaved && autoSaveTime) {
                    const timeDiff = Date.now() - parseInt(autoSaveTime);
                    if (timeDiff < 24 * 60 * 60 * 1000) { // 24Â∞èÊó∂ÂÜÖ
                        if (confirm('Ê£ÄÊµãÂà∞Ëá™Âä®‰øùÂ≠òÁöÑÂÜÖÂÆπÔºåÊòØÂê¶ÊÅ¢Â§çÔºü')) {
                            document.getElementById('monaco-editor').value = autoSaved;
                            this.onContentChange();
                        }
                    }
                }
                
                // Ê£ÄÊü•GitHubËøûÊé•Áä∂ÊÄÅ
                if (localStorage.getItem('lunatv_github_connected') === 'true') {
                    this.isConnected = true;
                    this.updateConnectionStatus();
                }
            }
        }
        
        // ÂêØÂä®Â∫îÁî®
        const app = new LunaTVEditor();
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });
        
        // ÂÖ®Â±ÄÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // ESCÈîÆÂÖ≥Èó≠Èù¢Êùø
                app.closeHistory();
                app.closeSidePanel();
                app.hideError();
            }
        });
        
        console.log('üåô Luna TV ÈÖçÁΩÆÁºñËæëÂô® v2.0 - ÂäüËÉΩÂÆåÂñÑÁâà');
    </script>
</body>
</html>
